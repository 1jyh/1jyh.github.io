<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1,user-scalable=no"><meta name="renderer" content="webkit"><meta name="color-scheme" content="dark light"><meta name="author" content="John Doe"><meta name="description" content=""><meta name="keywords" content=""><title>某H视频-mls</title><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="//at.alicdn.com/t/font_3242539_utq6ykfq7z.css"><link rel="stylesheet" light-src="https://cdn.staticfile.org/highlight.js/11.5.0/styles/default.min.css" dark-src="https://cdn.staticfile.org/highlight.js/11.5.0/styles/tokyo-night-dark.min.css"><link rel="stylesheet" href="https://fonts.font.im/css?family=Noto+Serif" as="font"><link href="/style/index.css" rel="stylesheet"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><header class="page-header"><nav><ul class="router-list"><li class="nav-item"> <a href="/">主页</a></li><li class="nav-item"> <a href="/archives/">归档</a></li><li class="nav-item"> <a href="/atom.xml">RSS</a></li></ul><div class="mode-switch"><span class="iconfont icon-DarkTheme"></span></div></nav></header><main><section class="main-content"><section class="post-page"><div class="title-bar"><h1>某H视频-mls</h1><div class="post-info"><span>2023-01-07 13:15:37</span><span class="tags"></span></div></div><article> <div class="content"><h2 id="分析流程"><a href="#分析流程" class="headerlink" title="分析流程"></a>分析流程</h2><p>这个软件呢，其实分析主要就是想要看他拉人获得vip的操作</p>
<p>抓包可以找到一个api</p>
<pre><code class="hljs plaintext">api/user/traveler</code></pre>

<p>这之前token还没有得到，参数</p>
<pre><code class="hljs plaintext">&#123;&quot;deviceId&quot;: device, &quot;dev&quot;: 随机3字符, &quot;code&quot;: &#x27;&#123;&quot;p&quot;:&quot;PDTVPD&quot;&#125;&#x27;&#125;</code></pre>

<p>这个code参数其实开始我也不知道是啥，走了一遍拉人的流程，发现app给我们的邀请链接有p参数，就是邀请码</p>
<pre><code class="hljs plaintext">https://z6mhir31k.xyz?p=PDTVPD</code></pre>

<p>在进到网页中点击下载软件会将邀请码复制到我们的粘贴板上</p>
<pre><code class="hljs plaintext">&#123;&quot;p&quot;:&quot;PDTVPD&quot;&#125;</code></pre>

<p>当你进入app时，读取粘贴板的第一条数据</p>
<pre><code class="hljs plaintext">public static String u() &#123;
       ClipData v0 = FragmentAnim.f.getSystemService(&quot;clipboard&quot;).getPrimaryClip();
       String v1 = &quot;&quot;;
       if(v0 != null &amp;&amp; v0.getItemCount() &gt; 0) &#123;
           CharSequence v0_1 = v0.getItemAt(0).getText();
           if(TextUtils.isEmpty(v0_1)) &#123;
               return v1;
           &#125;
           else &#123;
               return v0_1.toString();
           &#125;
       &#125;

       return v1;
   &#125;</code></pre>

<h3 id="deviceId"><a href="#deviceId" class="headerlink" title="deviceId"></a>deviceId</h3><p>顺着上去就发现了deviceId的生成</p>
<pre><code class="hljs plaintext">public final void C() &#123;
        String v0_2;
        String v3_1;
        String v1 = &quot;everb&quot;;
        String v2 = &quot;&quot;;
        if(a.a.exists()) &#123;
            try &#123;
                ObjectInputStream v0_1 = new ObjectInputStream(new FileInputStream(a.a));
                Object v3 = v0_1.readObject();
                try &#123;
                    v0_1.close();
                    goto label_21;
                &#125;
                catch(Exception v0) &#123;
                &#125;
            &#125;
            catch(Exception v0) &#123;
                v3_1 = v2;
            &#125;

            Log.d(v1, v0.toString());
        &#125;
        else &#123;
            v3_1 = v2;
        &#125;

    label_21:
        if(v3_1 == null) &#123;
            Log.d(v1, &quot;data == null&quot;);
            v3_1 = v2;
        &#125;

        if(TextUtils.isEmpty(((CharSequence)v3_1))) &#123;
            v0_2 = String.valueOf(System.currentTimeMillis() + UUID.randomUUID().getLeastSignificantBits());
            try &#123;
                byte[] v0_4 = MessageDigest.getInstance(&quot;MD5&quot;).digest(v0_2.getBytes());
                StringBuilder v1_1 = new StringBuilder();
                int v5;
                for(v5 = 0; v5 &lt; v0_4.length; ++v5) &#123;
                    String v6 = Integer.toHexString(v0_4[v5] &amp; 0xFF);
                    if(v6.length() &lt; 2) &#123;
                        v1_1.append(0);
                    &#125;

                    v1_1.append(v6);
                &#125;

                v3_1 = v1_1.toString();
            &#125;</code></pre>

<p>他会打开是个名为.CAD的文件，把deviceid写进去,如果像要看一遍生成新device，记得删除这个文件</p>
<p>但是我却没有搞懂这个deviceID的鉴别方法，你自己随便改一两位他都不会返回，看不懂</p>
<p>下面是用python模拟生成的deviceid</p>
<pre><code class="hljs plaintext">import uuid,hashlib,unpack
t = int(time.time()*1000)
uuid_bytes = uuid.uuid1().bytes
leastbit = struct.unpack(&#x27;&gt;q&#x27;, uuid_bytes[8:])[0]
print(leastbit)
v4 = hashlib.md5(str(t+leastbit).encode()).digest()
v2 = []
for i in v4:
    v1 = hex(i &amp; 0xFF)[2:]
    if len(v1) &lt; 2:
        v1 = &quot;0&quot;+v1
    v2.append(v1)
device = &#x27;&#x27;.join(v2)</code></pre>

<p>这个几把最低64位真的搞得烦，没见过</p>
<p>里面其实还有个chcode不知道是啥</p>
<pre><code class="hljs plaintext">public JSONObject c(String arg5, String arg6) &#123;
    this.a(&quot;deviceId&quot;, arg5);
    Random v5 = new Random();
    StringBuffer v0 = new StringBuffer();
    int v1;
    for(v1 = 0; v1 &lt; 3; ++v1) &#123;
        v0.append(&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;.charAt(v5.nextInt(62)));
    &#125;

    this.a(&quot;dev&quot;, v0.toString());
    if(arg6 != null) &#123;
        this.a(&quot;code&quot;, arg6);
    &#125;

    try &#123;
        arg5 = FragmentAnim.f.getPackageManager().getApplicationInfo(FragmentAnim.f.getPackageName(), 0x80).metaData.getString(&quot;UMENG_CHANNEL&quot;);
    &#125;
    catch(PackageManager$NameNotFoundException ) &#123;
        arg5 = &quot;&quot;;
    &#125;

    StringBuilder v6 = new StringBuilder();
    v6.append(&quot;--------------&gt;&quot;);
    v6.append(arg5);
    String v0_1 = &quot;渠道号：&quot;;
    Log.e(v0_1, v6.toString());
    if(!TextUtils.isEmpty(((CharSequence)arg5)) &amp;&amp; !arg5.equals(FragmentAnim.A())) &#123;
        this.a(&quot;chCode&quot;, arg5);
        Log.e(v0_1, &quot;chCode--------------&gt;&quot; + arg5);
    &#125;

    return b.b;
&#125;</code></pre>



<h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><p>在上面那个api中header中的s和t</p>
<pre><code class="hljs plaintext">import time,hashlin

t=str(int(time.time()*1000))
s=hsahlib.md5(t[3:8].encode()).hesdigest()</code></pre>

<p>到最后我发现妈的这软件好像也不加头，我的vip啊，也有可能是我哪里遗漏了些什么</p>
<p>注意ua,没带或者ua有问题都不会返回token，我在网上找的爬虫ua就不行，用模拟器自己生成的ua就行</p>
<p>个人里面那个填写invitecode的地方好像也是摆设</p>
<h3 id="encData"><a href="#encData" class="headerlink" title="encData"></a>encData</h3><p>在后面返回数据里encData是有加密的，aes&#x2F;cbc&#x2F;pkcs7,key和iv都是一样的</p>
<pre><code class="hljs plaintext">JhbGciOiJIUzI1Ni</code></pre>

<h3 id="m3u8解密"><a href="#m3u8解密" class="headerlink" title="m3u8解密"></a>m3u8解密</h3><p>m3u8文件解密，得到的m3u8文件里的key是假的</p>
<p>看了几个关于m3u8的类</p>
<p>会找到getkeyPath这个方法</p>
<p>key是在本地文件kdbc&#x2F;kb里，把key copy出来</p>
<p>配合N_m3u8DL-CLI可以下载m3u8文件</p>
<p>打印N_m3u8DL-CLI的命令,视频存放在Videos目录</p>
<pre><code class="hljs plaintext">def download():
    id = &#x27;1570&#x27;
    # 143811
    # 24323
    t = str(int(time.time()*1000))
    header = &#123;&#x27;deviceid&#x27;: &#x27;ac6819db96c1892587d63f353bd9a51c&#x27;,
              &#x27;t&#x27;: t,
              &#x27;s&#x27;: hashlib.md5(t[3:8].encode()).hexdigest(),
              &#x27;authorization&#x27;: &#x27;eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxMzMzNjQwNyIsImlzcyI6IiIsImlhdCI6MTY3MTI3NTY5NCwibmJmIjoxNjcxMjc1Njk0LCJleHAiOjE4Mjg5NTU2OTR9.766BQyjE6ZO5ZPC5Y6J0i5BZKmezUk7CXYo-cStNp_w&#x27;
              &#125;
    res = requests.get(
        f&#x27;https://mhapp.vxxsred.xyz/api/video/getVideoById?videoId=&#123;id&#125;&#x27;, headers=header).json()
    # print(res)
    data = res[&#x27;encData&#x27;]
    data = AES_decrypt(data, &#x27;JhbGciOiJIUzI1Ni&#x27;, &#x27;JhbGciOiJIUzI1Ni&#x27;)
    print(data)
    data = json.loads(data)
    print(data[&#x27;videoUrl&#x27;])
    print(&#x27;&quot;https://nwretbns.yongchengge.cn/&#x27; +
          data[&#x27;videoUrl&#x27;]+r&#x27;&quot; --workDir &quot;C:\Users\xx\Videos&quot; --useKeyFile &quot;C:\Users\xx\Desktop\N_m3u8DL-CLI_v3.0.2_with_ffmpeg_and_SimpleG\key\kb&quot;&#x27;)
    # https://videossy.tsk12.top/lfb/5c/5h/8n/rv/fb43cc643014465380e4c222aa60fb30.m3u8/
    # lfb/5c/5h/8n/rv/fb43cc643014465380e4c222aa60fb30.m3u8
    # &quot;https://nwretbns.yongchengge.cn/lfb/5c/5h/8n/rv/fb43cc643014465380e4c222aa60fb30.m3u8&quot; --workDir &quot;E:\tools\other\N_m3u8DL-CLI_v3.0.2_with_ffmpeg_and_SimpleG&quot; --useKeyFile &quot;C:\Users\jinchuan\Desktop\N_m3u8DL-CLI_v3.0.2_with_ffmpeg_and_SimpleG\key\kb&quot;
    # https://nwretbns.yongchengge.cn/lfb/5c/5h/8n/rv/fb43cc643014465380e4c222aa60fb30.m3u8</code></pre>

</div></article><div class="copyright-wrapper"><p>原文作者:<a href="http://example.com">John Doe</a></p><p>原文链接:<a href="http://example.com/2023/01/07/%E6%9F%90H%E8%A7%86%E9%A2%91-mls/">某H视频-mls</a></p><p>发表日期: 2023-01-07 13:15:37</p><p>更新日期: 2023-01-07 13:16:40</p><p>版权声明: 本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class="post-pager"><div class="prev"></div><div class="next"> <a href="/2022/11/20/hello-world/" title="Hello World">下一篇 Hello World</a></div></div><link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.css"/><script src="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.js"></script><div id="gitalk-container"></div><script>new Gitalk({
  clientID: '',
  clientSecret: '',
  repo: '',
  owner: '',
  admin: '',
  id: location.pathname.substr(0, 48),
  distractionFreeMode: true,
  labels: ['Gitalk'],
  title: '某H视频-mls',
}).render('gitalk-container');</script></section></section></main><footer class="footer-page"><div><span>Powered by</span><a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a><span>| Theme</span><a target="_blank" rel="noopener" href="https://github.com/techmovie/hexo-theme-instapaper">instapaper</a></div></footer><script src="/scripts/dark.js"></script><script src="/scripts/post.js"></script></body></html>